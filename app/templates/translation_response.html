{% extends "base.html" %}
{% block content %}

<div class="subcontainer">

  <h1>{{ _("Translation Challenge") }} <span style="font-weight:normal">({{ _("Beta") }})</span></h1>

  <div class="alert alert-success" style="display:none">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <div class="message"></div>
  </div>
  <div class="alert alert-error" style="display:none">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <div class="message"></div>
  </div>

  <div class="table">
    <div class="row-fluid">
      <div class="span3 header">{{ _("Original text") }} ({{ trequest.source | language_name }})</div>
      <div class="span9">{{ trequest.original_text }}</div>
    </div>

    {% if tresponse1 %}
    <div class="row-fluid">
      <div class="span3 header">{{ _("Regular translation") }} ({{ trequest.target | language_name }})</div>
      <div class="span9">{{ tresponse1.translated_text }}</div>
    </div>
    {% endif %}

    {% if tresponse2 %}
    <div class="row-fluid">
      <div class="span3 header">{{ _("Better translation") }} ({{ trequest.target | language_name }})</div>
      <div class="span9">{{ tresponse2.translated_text }}</div>
    </div>
    {% endif %}

    <div class="row-fluid">
      <div class="span3 header">{{ _("Your translation") }}</div>
      <div class="span9">
{% if tresponse %}
{% set tres_id_b62 = tresponse.id | uuid_to_b62 %}
        <p>{{ tresponse.translated_text }}</p>
        
        <button class="btn" style="min-width:7em;" onclick="location.href='{{ url_for('translation_responses', request_id=trequest.id) }}'">
          {{ _("See how others did") }}
        </button>
        <button class="btn btn-primary" style="min-width:7em;" translation-id="{{ tres_id_b62 }}" onclick="postTranslation(this)">{{ _("Post on Facebook") }}</button>
        <button class="btn btn-danger" style="min-width:7em;" onclick="deleteTranslation('{{ tres_id_b62 }}')">{{ _("Delete") }}</button>
{% else %}
        <form method="post" action="{{ url_for('translation_request_response_api', request_id=trequest.id | uuid_to_b62) }}">
          <input type="hidden" name="alert_flag" value="1"/>
          <textarea name="text" style="width:99%;height:10em;"></textarea>
          <div style="text-align:right">
            <button class="btn btn-primary" style="min-width:7em;">{{ _("Save") }}</button>
          </div>
        </form>
{% endif %}
      </div>
    </div>
  </div>
</div>

<script>
// TODO: Move this to main.js
function postTranslation(button) {
    // jQueryfy
    button = $(button);

    var translationId = button.attr("translation-id");

    button.attr("disabled", "disabled");

    $.post($.sprintf("/v1.0/tr/%s/post", translationId), function(response) {
        $("div.alert").hide();
        $("div.alert-success div.message").text(response.message);
        $("div.alert-success").show();
    }).fail(function(response) {
        console.log(response);
        $("div.alert").hide();
        $("div.alert-error div.message").text(response.responseText);
        $("div.alert-error").show();
    }).always(function() {
        button.removeAttr("disabled");
    });
}

</script>

{% endblock %}